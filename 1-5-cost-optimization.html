<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Microsoft Defender for Cloud Cost Optimization - Strategies to manage and reduce MDC costs while maintaining security coverage.">
    <title>Cost Optimization - Microsoft Defender for Cloud</title>
    <link rel="stylesheet" href="main.css">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ›¡ï¸</text></svg>">
</head>
<body>
    <div class="app-container">
        <aside class="sidebar">
            <div class="sidebar-header">
                <a href="index.html" class="sidebar-logo">
                    <div class="logo-icon">MDC</div>
                    <span class="logo-text">Defender for Cloud</span>
                </a>
                <button class="sidebar-toggle" aria-label="Toggle sidebar">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M12.79 5.23a.75.75 0 01-.02 1.06L8.832 10l3.938 3.71a.75.75 0 11-1.04 1.08l-4.5-4.25a.75.75 0 010-1.08l4.5-4.25a.75.75 0 011.06.02z" clip-rule="evenodd" />
                    </svg>
                </button>
            </div>
            <nav class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-section-title">Foundations</div>
                    <div class="nav-group expanded" data-group="foundations">
                        <div class="nav-group-header">
                            <span class="nav-group-title">Getting Started</span>
                            <svg class="nav-group-toggle" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M7.21 14.77a.75.75 0 01.02-1.06L11.168 10 7.23 6.29a.75.75 0 111.04-1.08l4.5 4.25a.75.75 0 010 1.08l-4.5 4.25a.75.75 0 01-1.06-.02z" clip-rule="evenodd" />
                            </svg>
                        </div>
                        <div class="nav-group-items">
                            <a href="1-1-overview.html" class="nav-subitem">Overview</a>
                            <a href="1-2-architecture.html" class="nav-subitem">Architecture</a>
                            <a href="1-4-enablement.html" class="nav-subitem">Enablement</a>
                            <a href="1-5-cost-optimization.html" class="nav-subitem active">Cost Optimization</a>
                        </div>
                    </div>
                </div>
            </nav>
        </aside>

        <main class="main-content">
            <header class="header">
                <div class="header-left">
                    <button class="mobile-menu-btn" aria-label="Open menu">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M2 4.75A.75.75 0 012.75 4h14.5a.75.75 0 010 1.5H2.75A.75.75 0 012 4.75zM2 10a.75.75 0 01.75-.75h14.5a.75.75 0 010 1.5H2.75A.75.75 0 012 10zm0 5.25a.75.75 0 01.75-.75h14.5a.75.75 0 010 1.5H2.75a.75.75 0 01-.75-.75z" clip-rule="evenodd" />
                        </svg>
                    </button>
                    <div class="search-box">
                        <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M9 3.5a5.5 5.5 0 100 11 5.5 5.5 0 000-11zM2 9a7 7 0 1112.452 4.391l3.328 3.329a.75.75 0 11-1.06 1.06l-3.329-3.328A7 7 0 012 9z" clip-rule="evenodd" />
                        </svg>
                        <input type="text" class="search-input" placeholder="Search documentation..." readonly>
                        <span class="search-shortcut">âŒ˜K</span>
                    </div>
                </div>
            </header>

            <div class="content-wrapper">
                <article class="page-content">
                    <nav class="breadcrumbs">
                        <a href="index.html" class="breadcrumb-item">Home</a>
                        <span class="breadcrumb-separator">/</span>
                        <a href="1-1-overview.html" class="breadcrumb-item">Foundations</a>
                        <span class="breadcrumb-separator">/</span>
                        <span class="breadcrumb-item current">Cost Optimization</span>
                    </nav>

                    <header class="page-header">
                        <h1>Cost Optimization</h1>
                        <div class="page-meta">
                            <span class="badge badge-l1">L1 Fundamentals</span>
                            <span class="badge badge-l2">L2 Operations</span>
                            <span class="page-meta-item">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm.75-13a.75.75 0 00-1.5 0v5c0 .414.336.75.75.75h4a.75.75 0 000-1.5h-3.25V5z" clip-rule="evenodd" />
                                </svg>
                                12 min read
                            </span>
                        </div>
                    </header>

                    <section>
                        <p>
                            Microsoft Defender for Cloud costs can scale significantly in large environments. 
                            This guide covers pricing models, cost estimation, and strategies to optimize 
                            spending while maintaining effective security coverage.
                        </p>
                    </section>

                    <!-- Pricing Overview -->
                    <section>
                        <h2 id="pricing">Pricing Overview</h2>

                        <div class="table-wrapper">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Plan</th>
                                        <th>Pricing Model</th>
                                        <th>Approximate Cost</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><strong>Defender CSPM</strong></td>
                                        <td>Per billable resource/month</td>
                                        <td>~$5/resource/month</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Defender for Servers P1</strong></td>
                                        <td>Per server/hour</td>
                                        <td>~$5/server/month</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Defender for Servers P2</strong></td>
                                        <td>Per server/hour</td>
                                        <td>~$15/server/month</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Defender for Containers</strong></td>
                                        <td>Per vCore/hour</td>
                                        <td>~$7/vCore/month</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Defender for Storage</strong></td>
                                        <td>Per storage account + transactions</td>
                                        <td>~$10/account/month + $0.15/10K txn</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Defender for SQL</strong></td>
                                        <td>Per instance/hour</td>
                                        <td>~$15/instance/month</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Defender for App Service</strong></td>
                                        <td>Per App Service Plan</td>
                                        <td>~$15/plan/month</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Defender for Key Vault</strong></td>
                                        <td>Per vault + transactions</td>
                                        <td>~$0.02/10K transactions</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Defender for ARM</strong></td>
                                        <td>Per subscription</td>
                                        <td>~$4/subscription/month</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Defender for DNS</strong></td>
                                        <td>Per million queries</td>
                                        <td>~$0.70/million queries</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <div class="callout callout-info">
                            <div class="callout-title">Free Tier</div>
                            <div class="callout-content">
                                <p>Foundational CSPM (Secure Score, basic recommendations, Azure Policy integration) 
                                is <strong>free</strong> for all Azure subscriptions. Premium features require paid plans.</p>
                            </div>
                        </div>
                    </section>

                    <!-- Cost Estimation -->
                    <section>
                        <h2 id="estimation">Cost Estimation</h2>

                        <div class="code-header">
                            <span class="code-lang">PowerShell</span>
                            <button class="code-copy-btn">Copy</button>
                        </div>
                        <pre><code class="language-powershell"># Estimate monthly MDC costs for your environment
$subscriptionId = (Get-AzContext).Subscription.Id

# Count billable resources
$vms = (Get-AzVM).Count
$arcServers = (Get-AzConnectedMachine -ErrorAction SilentlyContinue).Count
$storageAccounts = (Get-AzStorageAccount).Count
$sqlServers = (Get-AzSqlServer).Count
$appServicePlans = (Get-AzAppServicePlan).Count
$keyVaults = (Get-AzKeyVault).Count
$aksNodes = (Get-AzAksCluster | ForEach-Object { 
    (Get-AzAksNodePool -ClusterName $_.Name -ResourceGroupName $_.ResourceGroupName).Count * $_.AgentPoolProfiles[0].Count 
} | Measure-Object -Sum).Sum

Write-Host "=== MDC Cost Estimation ===" -ForegroundColor Cyan
Write-Host ""
Write-Host "Resource Counts:" -ForegroundColor Yellow
Write-Host "  VMs: $vms"
Write-Host "  Arc Servers: $arcServers"
Write-Host "  Storage Accounts: $storageAccounts"
Write-Host "  SQL Servers: $sqlServers"
Write-Host "  App Service Plans: $appServicePlans"
Write-Host "  Key Vaults: $keyVaults"
Write-Host "  AKS vCores (estimated): $aksNodes"
Write-Host ""
Write-Host "Estimated Monthly Costs:" -ForegroundColor Yellow
Write-Host "  Defender for Servers P2: $" + ($vms + $arcServers) * 15
Write-Host "  Defender for Storage: $" + ($storageAccounts * 10)
Write-Host "  Defender for SQL: $" + ($sqlServers * 15)
Write-Host "  Defender for App Service: $" + ($appServicePlans * 15)
Write-Host "  Defender for Containers: $" + ($aksNodes * 7)
Write-Host "  Defender CSPM: $" + (($vms + $storageAccounts + $sqlServers) * 5)
Write-Host ""
$total = (($vms + $arcServers) * 15) + ($storageAccounts * 10) + ($sqlServers * 15) + ($appServicePlans * 15) + ($aksNodes * 7) + (($vms + $storageAccounts + $sqlServers) * 5)
Write-Host "  ESTIMATED TOTAL: $" + $total + "/month" -ForegroundColor Green</code></pre>

                        <div class="code-header">
                            <span class="code-lang">Azure CLI</span>
                            <button class="code-copy-btn">Copy</button>
                        </div>
                        <pre><code class="language-bash"># Quick resource count for cost estimation
echo "=== Resource Counts ==="
echo "VMs: $(az vm list --query 'length(@)')"
echo "Storage Accounts: $(az storage account list --query 'length(@)')"
echo "SQL Servers: $(az sql server list --query 'length(@)')"
echo "App Service Plans: $(az appservice plan list --query 'length(@)')"
echo "Key Vaults: $(az keyvault list --query 'length(@)')"
echo "AKS Clusters: $(az aks list --query 'length(@)')"</code></pre>
                    </section>

                    <!-- Optimization Strategies -->
                    <section>
                        <h2 id="strategies">Optimization Strategies</h2>

                        <div class="ascii-diagram">
<span class="highlight-cyan">â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—</span>
<span class="highlight-cyan">â•‘</span>                           <span class="highlight-blue">COST OPTIMIZATION STRATEGIES</span>                                     <span class="highlight-cyan">â•‘</span>
<span class="highlight-cyan">â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£</span>
<span class="highlight-cyan">â•‘</span>                                                                                              <span class="highlight-cyan">â•‘</span>
<span class="highlight-cyan">â•‘</span>   <span class="highlight-green">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>   <span class="highlight-orange">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>   <span class="highlight-purple">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span> <span class="highlight-cyan">â•‘</span>
<span class="highlight-cyan">â•‘</span>   <span class="highlight-green">â”‚   RIGHT-SIZE PLANS      â”‚</span>   <span class="highlight-orange">â”‚  SELECTIVE COVERAGE     â”‚</span>   <span class="highlight-purple">â”‚   EXCLUDE NON-PROD      â”‚</span> <span class="highlight-cyan">â•‘</span>
<span class="highlight-cyan">â•‘</span>   <span class="highlight-green">â”‚                         â”‚</span>   <span class="highlight-orange">â”‚                         â”‚</span>   <span class="highlight-purple">â”‚                         â”‚</span> <span class="highlight-cyan">â•‘</span>
<span class="highlight-cyan">â•‘</span>   <span class="highlight-green">â”‚  â€¢ P1 vs P2 for servers â”‚</span>   <span class="highlight-orange">â”‚  â€¢ Production only      â”‚</span>   <span class="highlight-purple">â”‚  â€¢ Tag-based exclusion  â”‚</span> <span class="highlight-cyan">â•‘</span>
<span class="highlight-cyan">â•‘</span>   <span class="highlight-green">â”‚  â€¢ CSPM vs Defender CSPMâ”‚</span>   <span class="highlight-orange">â”‚  â€¢ Critical resources   â”‚</span>   <span class="highlight-purple">â”‚  â€¢ Dev/Test subscriptionsâ”‚</span><span class="highlight-cyan">â•‘</span>
<span class="highlight-cyan">â•‘</span>   <span class="highlight-green">â”‚  â€¢ Per-resource vs sub  â”‚</span>   <span class="highlight-orange">â”‚  â€¢ Internet-exposed     â”‚</span>   <span class="highlight-purple">â”‚  â€¢ Sandbox environments â”‚</span> <span class="highlight-cyan">â•‘</span>
<span class="highlight-cyan">â•‘</span>   <span class="highlight-green">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>   <span class="highlight-orange">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>   <span class="highlight-purple">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span> <span class="highlight-cyan">â•‘</span>
<span class="highlight-cyan">â•‘</span>                                                                                              <span class="highlight-cyan">â•‘</span>
<span class="highlight-cyan">â•‘</span>   <span class="highlight-blue">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>   <span class="highlight-red">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>   <span class="highlight-green">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span> <span class="highlight-cyan">â•‘</span>
<span class="highlight-cyan">â•‘</span>   <span class="highlight-blue">â”‚  MONITOR SPENDING       â”‚</span>   <span class="highlight-red">â”‚  CLEANUP UNUSED         â”‚</span>   <span class="highlight-green">â”‚   USE FREE TIER         â”‚</span> <span class="highlight-cyan">â•‘</span>
<span class="highlight-cyan">â•‘</span>   <span class="highlight-blue">â”‚                         â”‚</span>   <span class="highlight-red">â”‚                         â”‚</span>   <span class="highlight-green">â”‚                         â”‚</span> <span class="highlight-cyan">â•‘</span>
<span class="highlight-cyan">â•‘</span>   <span class="highlight-blue">â”‚  â€¢ Cost Management      â”‚</span>   <span class="highlight-red">â”‚  â€¢ Orphaned resources   â”‚</span>   <span class="highlight-green">â”‚  â€¢ Basic CSPM is free   â”‚</span> <span class="highlight-cyan">â•‘</span>
<span class="highlight-cyan">â•‘</span>   <span class="highlight-blue">â”‚  â€¢ Budget alerts        â”‚</span>   <span class="highlight-red">â”‚  â€¢ Stopped VMs          â”‚</span>   <span class="highlight-green">â”‚  â€¢ Secure Score free    â”‚</span> <span class="highlight-cyan">â•‘</span>
<span class="highlight-cyan">â•‘</span>   <span class="highlight-blue">â”‚  â€¢ Monthly reviews      â”‚</span>   <span class="highlight-red">â”‚  â€¢ Empty storage        â”‚</span>   <span class="highlight-green">â”‚  â€¢ Policy integration   â”‚</span> <span class="highlight-cyan">â•‘</span>
<span class="highlight-cyan">â•‘</span>   <span class="highlight-blue">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>   <span class="highlight-red">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>   <span class="highlight-green">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span> <span class="highlight-cyan">â•‘</span>
<span class="highlight-cyan">â•‘</span>                                                                                              <span class="highlight-cyan">â•‘</span>
<span class="highlight-cyan">â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span>
                        </div>

                        <h3>1. Right-Size Server Plans</h3>
                        <div class="table-wrapper">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Feature</th>
                                        <th>P1 (~$5/server)</th>
                                        <th>P2 (~$15/server)</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>MDE Integration</td>
                                        <td>âœ…</td>
                                        <td>âœ…</td>
                                    </tr>
                                    <tr>
                                        <td>Threat Detection</td>
                                        <td>âœ…</td>
                                        <td>âœ…</td>
                                    </tr>
                                    <tr>
                                        <td>Vulnerability Assessment</td>
                                        <td>âŒ</td>
                                        <td>âœ…</td>
                                    </tr>
                                    <tr>
                                        <td>JIT VM Access</td>
                                        <td>âŒ</td>
                                        <td>âœ…</td>
                                    </tr>
                                    <tr>
                                        <td>File Integrity Monitoring</td>
                                        <td>âŒ</td>
                                        <td>âœ…</td>
                                    </tr>
                                    <tr>
                                        <td>Agentless Scanning</td>
                                        <td>âŒ</td>
                                        <td>âœ…</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <div class="callout callout-tip">
                            <div class="callout-title">Recommendation</div>
                            <div class="callout-content">
                                <p>Use <strong>P2 for production</strong> servers (full vulnerability management) and 
                                <strong>P1 for dev/test</strong> servers (basic threat detection is usually sufficient).</p>
                            </div>
                        </div>

                        <h3>2. Exclude Non-Production Resources</h3>

                        <div class="code-header">
                            <span class="code-lang">Azure CLI</span>
                            <button class="code-copy-btn">Copy</button>
                        </div>
                        <pre><code class="language-bash"># Disable Defender for Servers on dev/test subscription
az security pricing create \
    --name VirtualMachines \
    --tier Free \
    --subscription "dev-test-subscription-id"

# Or use resource-level exclusion (Defender for Storage example)
# Exclude specific storage accounts from malware scanning
az security pricing create \
    --name StorageAccounts \
    --tier Standard \
    --extensions '[
        {
            "name": "OnUploadMalwareScanning",
            "isEnabled": "True",
            "additionalExtensionProperties": {
                "CapGBPerMonthPerStorageAccount": "5000"
            }
        }
    ]'</code></pre>

                        <h3>3. Cap Storage Malware Scanning</h3>
                        <p>Limit monthly scanning volume to control costs:</p>

                        <div class="code-header">
                            <span class="code-lang">Azure CLI</span>
                            <button class="code-copy-btn">Copy</button>
                        </div>
                        <pre><code class="language-bash"># Set monthly cap for malware scanning (in GB)
az security pricing create \
    --name StorageAccounts \
    --tier Standard \
    --extensions '[
        {
            "name": "OnUploadMalwareScanning",
            "isEnabled": "True",
            "additionalExtensionProperties": {
                "CapGBPerMonthPerStorageAccount": "1000"
            }
        }
    ]'</code></pre>
                    </section>

                    <!-- Monitor Costs -->
                    <section>
                        <h2 id="monitoring">Monitoring MDC Costs</h2>

                        <h3>Azure Cost Management</h3>
                        <ol>
                            <li>Azure Portal â†’ Cost Management + Billing</li>
                            <li>Cost analysis â†’ Filter by Service: "Microsoft Defender for Cloud"</li>
                            <li>Group by: Resource type or Subscription</li>
                        </ol>

                        <h3>Cost Alert</h3>
                        <div class="code-header">
                            <span class="code-lang">Azure CLI</span>
                            <button class="code-copy-btn">Copy</button>
                        </div>
                        <pre><code class="language-bash"># Create budget alert for MDC spending
az consumption budget create \
    --budget-name "MDC-Monthly-Budget" \
    --amount 1000 \
    --time-grain Monthly \
    --start-date "2024-01-01" \
    --end-date "2025-12-31" \
    --resource-group "your-rg" \
    --category Cost \
    --notifications '{
        "Actual_GreaterThan_80_Percent": {
            "enabled": true,
            "operator": "GreaterThan",
            "threshold": 80,
            "contactEmails": ["security-team@company.com"],
            "thresholdType": "Actual"
        }
    }'</code></pre>

                        <h3>KQL Cost Analysis</h3>
                        <div class="code-header">
                            <span class="code-lang">KQL</span>
                            <button class="code-copy-btn">Copy</button>
                        </div>
                        <pre><code class="language-kql">// MDC protected resources by plan
SecurityResources
| where type == "microsoft.security/pricings"
| extend Plan = properties.pricingTier, SubPlan = properties.subPlan
| summarize Count = count() by tostring(Plan), tostring(SubPlan)

// Resources per subscription for cost allocation
resources
| where type in~ (
    "microsoft.compute/virtualmachines",
    "microsoft.storage/storageaccounts",
    "microsoft.sql/servers",
    "microsoft.web/serverfarms"
)
| summarize 
    VMs = countif(type =~ "microsoft.compute/virtualmachines"),
    Storage = countif(type =~ "microsoft.storage/storageaccounts"),
    SQL = countif(type =~ "microsoft.sql/servers"),
    AppService = countif(type =~ "microsoft.web/serverfarms")
    by subscriptionId</code></pre>
                    </section>

                    <!-- Decision Framework -->
                    <section>
                        <h2 id="framework">Cost vs Coverage Framework</h2>

                        <div class="table-wrapper">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Environment Type</th>
                                        <th>Recommended Coverage</th>
                                        <th>Cost Impact</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><strong>Production - Internet Facing</strong></td>
                                        <td>Full coverage (CSPM + all Defenders, P2)</td>
                                        <td>High - Accept cost</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Production - Internal</strong></td>
                                        <td>Full coverage (CSPM + relevant Defenders, P2)</td>
                                        <td>Medium-High</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Staging/Pre-Prod</strong></td>
                                        <td>Defender for Servers P1, basic CSPM</td>
                                        <td>Medium</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Development</strong></td>
                                        <td>Basic CSPM (free), optional P1</td>
                                        <td>Low</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Sandbox/Lab</strong></td>
                                        <td>Free tier only</td>
                                        <td>None</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </section>

                    <!-- Checklist -->
                    <section>
                        <h2 id="checklist">Cost Optimization Checklist</h2>

                        <div class="checklist">
                            <div class="checklist-title">Monthly Review Checklist</div>
                            <ul>
                                <li>
                                    <input type="checkbox" id="cost1">
                                    <label for="cost1">Review Cost Management for MDC spending trends</label>
                                </li>
                                <li>
                                    <input type="checkbox" id="cost2">
                                    <label for="cost2">Identify subscriptions with highest MDC costs</label>
                                </li>
                                <li>
                                    <input type="checkbox" id="cost3">
                                    <label for="cost3">Verify non-production environments use appropriate plans</label>
                                </li>
                                <li>
                                    <input type="checkbox" id="cost4">
                                    <label for="cost4">Check for stopped VMs still being billed</label>
                                </li>
                                <li>
                                    <input type="checkbox" id="cost5">
                                    <label for="cost5">Review storage malware scanning caps</label>
                                </li>
                                <li>
                                    <input type="checkbox" id="cost6">
                                    <label for="cost6">Confirm only needed Defender plans are enabled</label>
                                </li>
                                <li>
                                    <input type="checkbox" id="cost7">
                                    <label for="cost7">Evaluate P1 vs P2 allocation per environment</label>
                                </li>
                            </ul>
                        </div>
                    </section>

                    <!-- Key Takeaways -->
                    <div class="key-takeaways">
                        <div class="key-takeaways-title">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M10 2a.75.75 0 01.75.75v.258a33.186 33.186 0 016.668.83.75.75 0 01-.336 1.461z" clip-rule="evenodd" />
                            </svg>
                            Key Takeaways
                        </div>
                        <ul>
                            <li>Basic CSPM (Secure Score, recommendations) is free</li>
                            <li>Defender for Servers P1 (~$5) vs P2 (~$15) - choose based on needs</li>
                            <li>Production = full coverage; Dev/Test = reduced or free tier</li>
                            <li>Use Azure Cost Management to monitor MDC spending</li>
                            <li>Set budget alerts to avoid cost surprises</li>
                            <li>Cap storage malware scanning to control per-transaction costs</li>
                            <li>Review costs monthly and adjust coverage as environment changes</li>
                            <li>Stopped VMs still incur MDC charges - deallocate or exclude</li>
                        </ul>
                    </div>

                    <div class="related-pages">
                        <div class="related-title">Related Pages</div>
                        <div class="related-list">
                            <a href="1-4-enablement.html" class="related-link">Enablement</a>
                            <a href="3-1-servers-overview.html" class="related-link">Defender for Servers</a>
                            <a href="3-7-storage.html" class="related-link">Defender for Storage</a>
                            <a href="12-2-powershell.html" class="related-link">PowerShell Scripts</a>
                        </div>
                    </div>

                    <nav class="page-nav">
                        <a href="1-4-enablement.html" class="page-nav-link prev">
                            <span class="page-nav-label">â† Previous</span>
                            <span class="page-nav-title">Enablement</span>
                        </a>
                        <a href="2-1-secure-score.html" class="page-nav-link next">
                            <span class="page-nav-label">Next â†’</span>
                            <span class="page-nav-title">Secure Score</span>
                        </a>
                    </nav>
                </article>

                <aside class="toc-sidebar">
                    <div class="toc-title">On This Page</div>
                    <ul class="toc-list">
                        <li class="toc-item"><a href="#pricing" class="toc-link">Pricing Overview</a></li>
                        <li class="toc-item"><a href="#estimation" class="toc-link">Cost Estimation</a></li>
                        <li class="toc-item"><a href="#strategies" class="toc-link">Optimization Strategies</a></li>
                        <li class="toc-item"><a href="#monitoring" class="toc-link">Monitoring Costs</a></li>
                        <li class="toc-item"><a href="#framework" class="toc-link">Decision Framework</a></li>
                        <li class="toc-item"><a href="#checklist" class="toc-link">Checklist</a></li>
                    </ul>
                </aside>
            </div>
        </main>
        <div class="mobile-overlay"></div>
    </div>

    <div class="search-modal">
        <div class="search-modal-content">
            <input type="text" class="search-modal-input" placeholder="Search documentation..." autofocus>
            <div class="search-results"></div>
        </div>
    </div>

    <script src="/main.js"></script>
</body>
</html>
